# https://github.com/minishift/minishift/releases adresten son versiyonu indiriyoruz. İndirilen yerden exe dosyası ile çalıştırıyoruz.

#### INFORMATION
# Minishift başlatabilmek için biostan virtualization ayarı açılmalı, Feature On/Off 'tan Hyper-V disable edilmeli(Virtualbox kullanılacaksa) ve Virtual Machine Platform disable edilmeli
#
# - save-start-flags: true bu değeri false yapılırsa kubernetes ayarları .kube/config'den silinmiyor, hata alıyor
# ~/.minishift dosyası server ayarlarını tutuyor. Sürekli hata alması durumunda silinebilir.
##  https://stackoverflow.com/questions/57436612/error-when-executing-minishift-start-connect-connection-refused
# cluster stop edildiğinde tekrar açılırken vpn ile açılırsa hata alıyor 

./minishift.exe start --cpus 4 --memory 6144 --vm-driver=virtualbox 

# server oluşturulduktan sonra openshift(oc) komut satırı kullanabilmek için env var eklenmeli

./minishift.exe oc-env  # bu komut oc için env var değeri verir

./minishift.exe docker-env  # Virtual Machine Platform disable edildiği için docker komutları kullanmıyoruz. Bu komutla env var değerleri alır ve komutları çalıştırabiliriz.

# Login as developer:
oc login -u developer

# Login as admin: 
oc login -u system:admin

# Get token:
oc whoami -t

# API call:
curl -k https://192.168.99.100:8443/oapi/v1/projects -H "Authorization: Bearer <token>"

# Herhangi bir usera admin yekisi verme system:admin kullanıcısıyla
oc adm policy add-cluster-role-to-user cluster-admin developer(user)

# run-docker-image-as-root :
create service account:  oc create sa ahmet-sa
oc adm policy add-scc-to-user anyuid -z ahmet-sa(serviceaccount) developer(user)

DeploymentConfig -> add under spec>template>spec

      serviceAccount: ahmet-sa
      serviceAccountName: ahmet-sa

oc set serviceaccount deployment reactapp ahmet-sa

# login oc registry
docker login -u developer -p $(oc whoami -t) 172.30.1.1:5000

    -> openshift-pull-image.sh (pull image from local repo and push oc registry)

# oc serverın timezone değiştirme

./minishift.exe ssh -- "sudo timedatectl set-timezone Europe/Istanbul"

# default serviceaccounta atama yapma sadece izleme olsun 
oc policy add-role-to-user view -z default



# OPENSHIFT CLUSTER INFO

### to connect cli via powershell
$env:KUBECONFIG="C:\Users\ahmet\OneDrive\Documents\Openshift-cli\openshift-client-windows\kubeconfig-noingress-openshift"

.\oc.exe get pods

### print all env
Get-ChildItem Env:

## serviceaccount policys
https://cloud.redhat.com/blog/managing-sccs-in-openshift


## Create user on Openshift using htpasswd
[https://www.youtube.com/watch?v=hbCQihvBaYU](yt source)
### creates file
htpasswd -c -B -b ./openshift.htpasswd user1 1234

### appends file
htpasswd -B -b ./openshift.htpasswd user2 1234

# giving user access to project
.\oc.exe adm policy add-role-to-user edit developer -n pavopay-dev

## env var for dotnet core application
ASPNETCORE_URLS=http://*:8080

# expose 8080


# oc serverın timezone değiştirme
## admin user ile giriş yapıyoruz ve Administrator > Compute > Nodes > Terminal'e giriyoruz.
## local zonu silip yeni tz ayarlıyoruz
[https://linuxize.com/post/how-to-set-or-change-timezone-in-linux/](site link)

```
sudo rm -rf /etc/localtime
sudo ln -s /usr/share/zoneinfo/Europe/Istanbul /etc/localtime
date
```

### If you do not want the Cluster Version Operator to fetch available updates from the update recommendation service :

```
 .\oc.exe adm upgrade channel --allow-explicit-channel
```

 warning: Clearing channel "stable-4.12"; cluster will no longer request available update recommendations.
 [https://access.redhat.com/documentation/en-us/openshift_container_platform/4.12/html/updating_clusters/understanding-upgrade-channels-releases#understanding-upgrade-channels_understanding-upgrade-channels-releases](site link)